# 公开分配内部

在WebAssembly模块周围生成JavaScript主机垫片的工具经常使用的一种模式是使用显式(或手动)分配。当主机希望创建由客户控制的内容时，主机基本上可以执行等同于malloc的操作——请求客户分配一组字节并返回指向这些字节的指针(这些字节将存储在模块的线性内存中)。

你可能会看到类似以下伪代码的主机代码:

```javascript
var myGame = new my_module_wrapper();
```

在包装器构造函数内部，您可能会发现生成的代码通过显式调用导出的分配器函数从guest模块请求智能指针。此模式依赖于客户机和主机之间关于内存分配如何发生的共享的、紧密耦合的知识。

需要明确的是，这种模式在本质上或客观上都没有错。与所有模式一样，它具有最佳的目标场景和潜在的危险场景。对于事先知道主人和客人的特征的情况，这种模式非常有用。如果您正在使用JavaScript在浏览器中调用rust来源的WebAssembly模块，那么无论如何，使用bindgen工具套件生成的代码可以为您节省大量的时间和精力(以及键入!)。

然而，本课程其余部分的主题是关于在云中、边缘和中间的任何地方使用WebAssembly——当主机需要与客户机尽可能松散耦合时。为了满足这些需求，我们需要一种更安全、松散耦合的方法来在客户机和主机之间进行通信。